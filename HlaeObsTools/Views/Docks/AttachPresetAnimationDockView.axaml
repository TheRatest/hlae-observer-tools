<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:HlaeObsTools.ViewModels.Docks"
             xmlns:local="using:HlaeObsTools.ViewModels"
             xmlns:conv="using:HlaeObsTools.Converters"
             x:Class="HlaeObsTools.Views.Docks.AttachPresetAnimationDockView"
             x:DataType="vm:AttachPresetAnimationDockViewModel">

    <UserControl.Resources>
        <conv:DoubleTextConverter x:Key="Double0" DefaultValue="0" />
        <conv:NullableDoubleTextConverter x:Key="NullableDouble" />
        <DataTemplate x:Key="EventTemplate" x:DataType="local:AttachPresetAnimationEventViewModel">
            <Border BorderBrush="#333" BorderThickness="1" Padding="8" Margin="0,0,0,8">
                <StackPanel Spacing="8">
                    <Grid ColumnDefinitions="*,Auto,Auto,Auto,Auto" ColumnSpacing="8">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="Time" Foreground="#AAAAAA" VerticalAlignment="Center"/>
                            <TextBox Width="90"
                                     Text="{Binding Time, Mode=TwoWay, Converter={StaticResource Double0}}"
                                     IsEnabled="{Binding !IsBaseKeyframe}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="Type" Foreground="#AAAAAA" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding Type}"
                                       Foreground="#E6E6E6"
                                       VerticalAlignment="Center"/>
                        </StackPanel>

                        <Button Grid.Column="2"
                                Content="▲"
                                Width="32"
                                Click="MoveEventUp_Click"
                                IsEnabled="{Binding !IsBaseKeyframe}"/>
                        <Button Grid.Column="3"
                                Content="▼"
                                Width="32"
                                Click="MoveEventDown_Click"
                                IsEnabled="{Binding !IsBaseKeyframe}"/>
                        <Button Grid.Column="4"
                                Content="Delete"
                                Click="DeleteEvent_Click"
                                IsEnabled="{Binding !IsBaseKeyframe}"/>
                    </Grid>

                    <StackPanel IsVisible="{Binding IsKeyframe}" Spacing="8">
                        <TextBlock Text="Δ Position (camera space)"
                                   Foreground="#CCCCCC"/>
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <TextBox Width="80" Watermark="X" Text="{Binding DeltaPosX, Mode=TwoWay, Converter={StaticResource NullableDouble}}" />
                            <TextBox Width="80" Watermark="Y" Text="{Binding DeltaPosY, Mode=TwoWay, Converter={StaticResource NullableDouble}}" />
                            <TextBox Width="80" Watermark="Z" Text="{Binding DeltaPosZ, Mode=TwoWay, Converter={StaticResource NullableDouble}}" />
                        </StackPanel>

                        <TextBlock Text="Δ Rotation (deg)"
                                   Foreground="#CCCCCC"/>
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <TextBox Width="80" Watermark="Pitch" Text="{Binding DeltaPitch, Mode=TwoWay, Converter={StaticResource NullableDouble}}" />
                            <TextBox Width="80" Watermark="Yaw" Text="{Binding DeltaYaw, Mode=TwoWay, Converter={StaticResource NullableDouble}}" />
                            <TextBox Width="80" Watermark="Roll" Text="{Binding DeltaRoll, Mode=TwoWay, Converter={StaticResource NullableDouble}}" />
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="Easing curve" Foreground="#AAAAAA" VerticalAlignment="Center"/>
                            <ComboBox Width="160"
                                      ItemsSource="{x:Static local:AttachPresetAnimationEventViewModel.KeyframeEasingCurveOptions}"
                                      SelectedItem="{Binding KeyframeEasingCurve, Mode=TwoWay}"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Spacing="8"
                                    IsVisible="{Binding UsesKeyframeEasingMode}">
                            <TextBlock Text="Ease" Foreground="#AAAAAA" VerticalAlignment="Center"/>
                            <ComboBox Width="160"
                                      ItemsSource="{x:Static local:AttachPresetAnimationEventViewModel.KeyframeEasingModeOptions}"
                                      SelectedItem="{Binding KeyframeEasingMode, Mode=TwoWay}"/>
                        </StackPanel>

                        <TextBlock Text="FOV (absolute)"
                                   Foreground="#CCCCCC"/>
                        <TextBox Width="100" Watermark="(base)" Text="{Binding Fov, Mode=TwoWay, Converter={StaticResource NullableDouble}}"
                                HorizontalAlignment="Left" />
                    </StackPanel>

                    <StackPanel IsVisible="{Binding IsTransition}" Spacing="8">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="Duration (s)" Foreground="#AAAAAA" VerticalAlignment="Center"/>
                            <TextBox Width="90"
                                     Text="{Binding TransitionDuration, Mode=TwoWay, Converter={StaticResource NullableDouble}}"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="Easing" Foreground="#AAAAAA" VerticalAlignment="Center"/>
                            <ComboBox Width="160"
                                      ItemsSource="{x:Static local:AttachPresetAnimationEventViewModel.TransitionEasingOptions}"
                                      SelectedItem="{Binding TransitionEasing, Mode=TwoWay}"/>
                        </StackPanel>

                        <TextBlock Text="Transition marker: animates toward the selected target player."
                                   Foreground="#888888"
                                   FontSize="12"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </DataTemplate>
    </UserControl.Resources>

    <ScrollViewer>
        <StackPanel Margin="10" Spacing="10">
            <TextBlock Text="Preset Animation"
                       Foreground="#CCCCCC"
                       FontWeight="SemiBold"/>

            <Border BorderBrush="#333" BorderThickness="1" Padding="10" IsVisible="{Binding HasPreset}">
                <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10" RowDefinitions="Auto,Auto">
                    <TextBlock Text="{Binding Preset.Title}"
                                Foreground="#E6E6E6"
                                FontSize="14"
                                FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding Preset.AnimationSummary}"
                            Foreground="#888888"
                            FontSize="12"
                            Grid.Column="1"/>

                    <StackPanel Orientation="Horizontal" Spacing="8" Grid.ColumnSpan="2" Grid.Row="1">
                        <Button Content="Add keyframe" Command="{Binding AddKeyframeCommand}" />
                        <Button Content="Add transition" Command="{Binding AddTransitionCommand}" />
                    </StackPanel>
                    <ToggleSwitch   Grid.Column="2"
                                    Grid.RowSpan="2"
                                    IsChecked="{Binding Preset.AnimationEnabled, Mode=TwoWay}"
                                    Content="Enabled"
                                    Foreground="#E6E6E6"/>
                </Grid>
            </Border>

            <Border BorderBrush="#333" BorderThickness="1" Padding="10" IsVisible="{Binding !HasPreset}">
                <TextBlock Text="Select an attach preset and click “Animation” to edit its timeline."
                           Foreground="#888888"/>
            </Border>

            <ItemsControl ItemsSource="{Binding Preset.AnimationEvents}"
                          ItemTemplate="{StaticResource EventTemplate}"
                          IsVisible="{Binding HasPreset}"/>
        </StackPanel>
    </ScrollViewer>
</UserControl>
